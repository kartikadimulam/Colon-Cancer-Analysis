---
title: "PSTAT175-ProjectBrief"
author: "Kartik Adimulam"
date: "2025-04-29"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE}
library(survival)
library(survminer)
library(ggplot2) 
library(tidyr)
library(xfun)
```

# 1. Introduction
## Overview of the Dataset

We are studying the Chemotherapy for Stage B/C colon cancer dataset from the `survival` package in R (Laurie et al., 1989). This dataset comes from one of the first successful trials of chemotherapy for colon cancer. It examines the impact of treating patients with just a compound called Levamisole or a combination of it and 5-FU, a moderately toxic chemotherapy agent, or neither. Each patient has two records, one for recurrence and one for death, which we will take into account in our analysis.

Our dataset contains survival time data of days until death of colon cancer patients that received different levels of chemotherapy. The primary covariate in our analysis is the 'rx' treatment variable which has 3 levels (No treatment, low-toxicity treatment, and moderate toxicity treatment) and the censoring status indicator. There are other covariates such as:  
  - `sex`: male (1) or female (0) \
  - `age`: in years \
  - `obstruct`: was the colon obstructed by the tumor? \
  - `perfor`: was the colon perforated? \
  - `adhere`: is the tumor on nearby organs? \
  - `nodes`: how many lymph nodes have cancer? \
  - `differ`: is the tumor differentiated? \
  - `extent`: how much has the tumor spread locally? \
  - `surg`: how long from surgery to registration? \
  - `node4`: indicator variable of more than 4 positive lymph nodes \
  - `etype`: did subject's cancer recur or death \
  
## Motivating Questions 
The scientific questions we are trying to answer are: \
  1. Does the type of treatment (levamisole or 5-FU) affect survival times? \
  2. Are there some covariates that are not strong predictors and if so which ones? \
  3. How much is survival probability affected by different covariate values? \
  4. Do covariates affect survival probability differently over time? \
  5. Are there important interactions between these covariates? \

```{r, include = FALSE}
head(colon)
```

## Survival Probability of Treatments 
In our first step of evaluating which treatments affect survival times, we create a Kaplan Meier estimate plot to visualize and gain a base understanding of how the 3 treatments in the dataset affect the survival probabilities of colon cancer patients. 
```{r, warning = FALSE}
colon=colon
colon_fit = survfit(Surv(time, status) ~ rx, colon)
ggsurvplot(colon_fit, colon, title='KM Estimator Colon Cancer',xlab='time',
           ylab='Survival Prob.',surv.median.line = 'hv',palette = "Dark2", 
           conf.int = TRUE,    
           risk.table = TRUE,
           ggtheme = theme_minimal(), 
           font.main = c(16, "bold", "black"),  
           font.x = c(14, "bold"),            
           font.y = c(14, "bold"))
```
From the graph, we observe that the patients with the treatment that combines 5FU and Levamisole have a higher survival probability than those with no treatment and those with just the Levamisole treatment. The survival probability for patients with the Levamisole treatment seem to not have a large difference compared to those with no treatment, but the patients with no treatment have the lowest survival time. 

## Splitting Data 
```{r}
colon.recur = colon[colon$etype==1,]
colon.death = colon[colon$etype==2,]

colon.recur.cox = coxph(Surv(time,status)~rx, colon.recur)
summary(colon.recur.cox)
anova(colon.recur.cox)

colon.death.cox = coxph(Surv(time, status) ~ rx, colon.death)
summary(colon.death.cox)
anova(colon.death.cox)
```
In our time until recurrence model, treatment using Levamisole compared with the baseline effect has a p-value of 0.888. This teaches us that this low-toxicity compound is not effective in reducing the time until recurrence for colon cancer patients.

However, the p-value of the treatment which combines 5FU (moderately toxic)  treatment and Levamisole (low toxicity) is 0.00002. We can conclude that the combination of 5FU and Levamisole is effective in reducing time until recurrence but the treatment of just using Levamisole is not. 

Overall, we observe using a likelihood ratio test p-value of ~0 that the treatment itself is effective in reducing time until recurrence, but most of this effect is likely due to the high effectiveness of Levamisole+5FU treatment. 

In our time until death model, treatment using Levamisole compared with the baseline effect has a p-value of 0.809. This teaches us that this low-toxicity compound is not effective in reducing the time until death for colon cancer patients.

However, the p-value of the treatment which combines 5FU (moderately toxic)  treatment and Levamisole (low toxicitity) is 0.0018. We can conclude that the combination of 5FU and Levamisole is effective in reducing time until death but the treatment of just using Levamisole is not. This is an outcome that is discussed in the original study, which states that "after correction for imbalances in prognostic variables, were only suggestive for levamisole alone (P = .05) but quite significant for levamisole plus 5-FU (P = .003)" (Laurie et al., 1989). It is interesting, however, that our p-value for levamisole treatment alone obtained from our cox PH model is so much higher than the p-value obtained by the researchers of this study. Although both of us agree that Levamisole treatment in itself in ineffective, our level of ineffectiveness is much higher than that of the study. This could potentially be attributed to the treatment of other covariates by the researchers differing from our own treatment. 

Overall, we observe using a likelihood ratio test p-value of 0.0023 that the treatment itself is effective in reducing time until death, but most of this effect is likely due to the high effectiveness of Levamisole+5FU treatment. 


## Confidence Intervals
```{r}
colon.recur.CI = exp(confint(colon.recur.cox))
colon.death.CI = exp(confint(colon.death.cox))
```
Again the CIs show that Levamisole treatment is not significant but Levamisole+5FU treatment
is effective in reducing time until recurrence and death. Our hazard ratio CI for Lev treatment contains 1 for both models, but our hazard ratio CI for Lev+5FU treatment does not contain 1 for both models. We are 95% confident that Lev+5FU treatment significantly affects both time until recurrence and time until death. 


## Hazard Ratio
```{r}
exp(coef(colon.recur.cox))
exp(coef(colon.death.cox))
```

At any point in time Lev+5FU treated patients are 0.6 times as likely to have a colon cancer recurrence compared to patients without treatment. The patients with Lev+5FU are 0.69 times as likely to have a colon cancer death compared to patients without treatment. 

# 2. Model Fitting 
## Recurrence of Cancer Subset
Using forward stepwise selection  and AIC, we can find the most relevant covariates to build and finds the best model at predicting survival times. We first perform this process on the subset of data where there was a recurrence of cancer in patients. 
```{r, warning = FALSE}
colon.rx.sex = coxph(Surv(time,status)~rx + sex, colon.recur)
colon.rx.age = coxph(Surv(time,status)~rx + age, colon.recur)
colon.rx.obstruct = coxph(Surv(time,status)~rx + obstruct, colon.recur)
colon.rx.perfor = coxph(Surv(time,status)~rx + perfor, colon.recur)
colon.rx.adhere = coxph(Surv(time,status)~rx + adhere, colon.recur)
colon.rx.nodes = coxph(Surv(time,status)~rx + nodes, colon.recur)
colon.rx.differ = coxph(Surv(time,status)~rx + differ, colon.recur)
colon.rx.extent = coxph(Surv(time,status)~rx + extent, colon.recur)
colon.rx.surg = coxph(Surv(time,status)~rx + surg, colon.recur)
colon.rx.node4 = coxph(Surv(time,status)~rx + node4, colon.recur)

AIC(colon.rx.sex, colon.rx.age, colon.rx.obstruct, colon.rx.perfor,
    colon.rx.adhere, colon.rx.nodes, colon.rx.differ, colon.rx.extent,
    colon.rx.surg, colon.rx.node4)
```

The best model is adding nodes as a covariate, attaining an AIC of 5827.4. The second best model is differentiation of tumor and the third best is node4 (more than 4 positive lymph nodes). However, we should not include node4 since it is highly correlated with nodes. They are essentially measuring the same thing and in the dataset description it says it is unknown which of the two variables is correct, so this is a somewhat arbitrary selection.

```{r,  warning = FALSE}
colon.rx.nodes.differ = coxph(Surv(time,status)~rx + nodes + differ, colon.recur)
colon.rx.nodes.sex = coxph(Surv(time,status)~rx + nodes + sex, colon.recur)
colon.rx.nodes.age = coxph(Surv(time,status)~rx + nodes + age, colon.recur)
colon.rx.nodes.obstruct = coxph(Surv(time,status)~rx + nodes + obstruct, colon.recur)
colon.rx.nodes.perfor = coxph(Surv(time,status)~rx + nodes + perfor, colon.recur)
colon.rx.nodes.adhere = coxph(Surv(time,status)~rx + nodes + adhere, colon.recur)
colon.rx.nodes.extent = coxph(Surv(time,status)~rx + nodes + extent, colon.recur)
colon.rx.nodes.surg = coxph(Surv(time,status)~rx + nodes + surg, colon.recur)

AIC(colon.rx.nodes.differ, colon.rx.nodes.sex, colon.rx.nodes.age, colon.rx.nodes.obstruct, colon.rx.nodes.perfor, colon.rx.nodes.adhere, colon.rx.nodes.extent, colon.rx.nodes.surg)
```
Adding differ as the next covariate is the best model, as our model now has an AIC of 5676.21 

```{r}
colon.rnd.sex = coxph(Surv(time,status)~rx + nodes + differ + sex, colon.recur)
colon.rnd.age  = coxph(Surv(time,status)~rx + nodes + differ + age, colon.recur)
colon.rnd.obstruct  = coxph(Surv(time,status)~rx + nodes + differ + obstruct, colon.recur)
colon.rnd.perfor  = coxph(Surv(time,status)~rx + nodes + differ +perfor , colon.recur)
colon.rnd.adhere = coxph(Surv(time,status)~rx + nodes + differ +adhere , colon.recur)
colon.rnd.extent = coxph(Surv(time,status)~rx + nodes + differ + extent, colon.recur)
colon.rnd.surg  = coxph(Surv(time,status)~rx + nodes + differ +surg , colon.recur)
AIC(colon.rnd.sex, colon.rnd.age, colon.rnd.obstruct, colon.rnd.perfor, colon.rnd.adhere, colon.rnd.extent, colon.rnd.surg)
```
Adding extent as the next covariate is the best model, attaining an AIC of 5658.7

```{r,  warning = FALSE}
BIC(colon.rnd.extent,colon.rx.nodes.differ, colon.rx.nodes, colon.recur.cox)
```
Using BIC as a sanity check helps us to verify that adding extent as another covariate is still beneficial to our model's prediction accuracy while avoiding overfitting (too many covariates), attaining a BIC of 5679.21. 

```{r}
colon.rnde.sex = coxph(Surv(time,status)~rx + nodes + differ + extent + sex, colon.recur)
colon.rnde.age = coxph(Surv(time,status)~rx + nodes + differ + extent + age, colon.recur)
colon.rnde.obstruct = coxph(Surv(time,status)~rx + nodes + differ + extent + obstruct, colon.recur)
colon.rnde.perfor = coxph(Surv(time,status)~rx + nodes + differ + extent + perfor, colon.recur)
colon.rnde.adhere = coxph(Surv(time,status)~rx + nodes + differ + extent + adhere, colon.recur)
colon.rnde.surg = coxph(Surv(time,status)~rx + nodes + differ + extent + surg, colon.recur)

AIC(colon.rnde.sex, colon.rnde.age, colon.rnde.obstruct, colon.rnde.perfor,
    colon.rnde.adhere, colon.rnde.surg)
BIC(colon.rnde.sex, colon.rnde.age, colon.rnde.obstruct, colon.rnde.perfor,
    colon.rnde.adhere, colon.rnde.surg)
```
Adding Surg (time from surgery until registration into the study) as our next covariate again lowers our AIC to 5655.55

```{r}
colon.rndes.sex = coxph(Surv(time,status)~rx + nodes + differ + extent + surg + sex, colon.recur)
colon.rndes.age = coxph(Surv(time,status)~rx + nodes + differ + extent + surg + age, colon.recur)
colon.rndes.obstruct = coxph(Surv(time,status)~rx + nodes + differ + extent + surg + obstruct, colon.recur)
colon.rndes.perfor = coxph(Surv(time,status)~rx + nodes + differ + extent + surg + perfor, colon.recur)
colon.rndes.adhere = coxph(Surv(time,status)~rx + nodes + differ + extent + surg + adhere, colon.recur)

AIC(colon.rndes.sex, colon.rndes.age, colon.rndes.obstruct, colon.rndes.perfor, colon.rndes.adhere)
```
We attain a slightly lower AIC of 5654.37 by adding sex as our next covariate. However, since the change is small we will verify this using BIC score too. 

```{r}
BIC(colon.rndes.sex, colon.rnde.surg)
```
Using BIC score instead, which penalizes more covariates more intensely than AIC, we see that our previous model is actually preferable, so we will stop adding covariates at Surg. 

```{r}
anova(colon.rndes.sex)
```
We also verify this by checking that if we add sex as a covariate, it is not significantly affecting time until recurrence from the likelihood ratio test.


### Checking Proportional Hazards Assumptions

```{r}
colon.fit = survfit(Surv(time, status) ~ rx, colon.recur)
ggsurvplot(colon.fit, colon.recur, 
           legend.labs=c('Level 1','Level 2', 'Level 3'), 
           fun='cloglog') + 
  labs(x='Days until Recurrence')

cox.zph(colon.recur.cox)
```
The proportional hazards assumption seems violated from the log-log plot for Baseline and low toxicity treatment, but we have already observed that those two treatments do not significantly differ in hazard rates. It appears that the difference between low toxicity and medium toxicity does not violate the proportional hazards assumption, and we verify this using the Schoenfield residuals test attaining a p-value of 0.86 for the rx covariate. 

```{r}
cox.zph(colon.rnde.surg)
colon.fit.differ = survfit(Surv(time, status) ~ differ, colon.recur)
ggsurvplot(colon.fit.differ, colon.recur, 
           legend.labs=c('Well','Moderate', 'Poor'), fun='cloglog') +
  labs(x='Days until Recurrence')
```
From our cox ZPH test we see that the differentiation of tumor covariate violates the proportional hazards assumption with a p-value of 0.00024 and we verify this using a log-log plot. We can observe many cross-over points between the plot for 'moderate' differentiation and 'well' differentiation. To account for this violation, we will attempt to stratify on the differentiation covariate and produce a stratified Cox PH model. 

```{r}
colon.rnde.surg = coxph(Surv(time,status)~rx + nodes + strata(differ) + extent + surg, colon.recur)
anova(colon.rnde.surg)
cox.zph(colon.rnde.surg)

mean(colon.recur$nodes, na.rm=TRUE)
max(colon.recur$nodes, na.rm=TRUE)
```
Our AIC drops to 4967.46 after stratifying on the differentiation variable instead of simply including it as a covariate in our model. This is a significant decrease in AIC most likely due to the fact that differentiation should have never been included as a covariate in the model, as it violated the proportional hazards assumption. 

To verify again that none of our covariates violate this assumption, we will run the Cox ZPH test on our new stratified model. We observe that all of our p-values are greater than 0.05 and we can keep them in our model as covariates. 

In our final cox PH model, for recurrence, we observe numerous interesting effects of the covariates. The most important, of course, is that the combination of low-toxicity Levamisole treatment and medium-toxicity 5FU treatment is effective in reducing the hazard rate by a factor of 0.601. Other effects that are notable are that of the number of lymph nodes with detectable cancer. We see from our model output that with every additional lymph node, the hazard rate increases by a factor of 1.078. This is not a huge effect, but it is important to note that the number of lymph nodes with cancer were as high as 33 in our data set, so the hazard rate could gradually increase to significantly high levels as this covariate increases for certain subjects. However, the mean of this covariate is only ~ 3.7 nodes. We see a larger effect for the extent covariate which measures the extent of local spread using 4 levels. For each level increase, the hazard rate increases significantly by a factor of 1.66. This is an intuitive finding, as the extent of cancer spread is a strong indicator of a patient having a recurrence or death. 

Another influential covariate in our model is surg, which is a binary indicator of the time from surgery to registration. Patients that had a long time have a hazard rate that is 1.28 times the baseline hazard. This is an interesting finding and indicates that the time spent between surgery and registration is vital to the time it took patients to have a disease recurrence or death. This is also an intuitive finding, as a patient that had a long time in between is experiencing more time that could contribute to the growth of cancer spread. 

## Death Subset 
Using the same exact process as above for the data with etype=1 (recurrence of cancer), we find that for etype = 2 (death), the model had the same covariates until adding the 6th covariate. Adding obstruct to the death cox model gave us the next best model which is different from the recur data, where at this point, adding sex as our next covariate gave us the lower AIC score. However, in both subsets of data, adding the 6th covariate gave us a higher BIC score, allowing us to leave it out and have the same covariates (rx, node, differ, extent, surg).
```{r, include = FALSE}
death.rx.sex = coxph(Surv(time,status)~rx + sex, colon.death)
death.rx.age = coxph(Surv(time,status)~rx + age, colon.death)
death.rx.obstruct = coxph(Surv(time,status)~rx + obstruct, colon.death)
death.rx.perfor = coxph(Surv(time,status)~rx + perfor, colon.death)
death.rx.adhere = coxph(Surv(time,status)~rx + adhere, colon.death)
death.rx.nodes = coxph(Surv(time,status)~rx + nodes, colon.death)
death.rx.differ = coxph(Surv(time,status)~rx + differ, colon.death)
death.rx.extent = coxph(Surv(time,status)~rx + extent, colon.death)
death.rx.surg = coxph(Surv(time,status)~rx + surg, colon.death)
death.rx.node4 = coxph(Surv(time,status)~rx + node4, colon.death)

AIC(death.rx.sex, death.rx.age, death.rx.obstruct, death.rx.perfor,
    death.rx.adhere, death.rx.nodes, death.rx.differ, death.rx.extent,
    death.rx.surg, death.rx.node4)

```

The best model in the data for patients with a recorded death adds nodes with an AIC of 5620.639. The second best model adds differ with an AIC of 5678.121 and the third best model adds node4 with an AIC of 5764.921. 

```{r, include = FALSE}
death.rx.nodes.differ = coxph(Surv(time,status)~rx + nodes + differ, colon.death)
death.rx.nodes.sex = coxph(Surv(time,status)~rx + nodes + sex, colon.death)
death.rx.nodes.age = coxph(Surv(time,status)~rx + nodes + age, colon.death)
death.rx.nodes.obstruct = coxph(Surv(time,status)~rx + nodes + obstruct, colon.death)
death.rx.nodes.perfor = coxph(Surv(time,status)~rx + nodes + perfor, colon.death)
death.rx.nodes.adhere = coxph(Surv(time,status)~rx + nodes + adhere, colon.death)
death.rx.nodes.extent = coxph(Surv(time,status)~rx + nodes + extent, colon.death)
death.rx.nodes.surg = coxph(Surv(time,status)~rx + nodes + surg, colon.death)

AIC(death.rx.nodes.differ, death.rx.nodes.sex, death.rx.nodes.age, death.rx.nodes.obstruct, death.rx.nodes.perfor, death.rx.nodes.adhere, death.rx.nodes.extent, death.rx.nodes.surg)

```

After adding differ we got an AIC of 5458.958.

```{r, include = FALSE}
death.rnd.sex = coxph(Surv(time,status)~rx + nodes + differ + sex, colon.death)
death.rnd.age  = coxph(Surv(time,status)~rx + nodes + differ + age, colon.death)
death.rnd.obstruct  = coxph(Surv(time,status)~rx + nodes + differ + obstruct, colon.death)
death.rnd.perfor  = coxph(Surv(time,status)~rx + nodes + differ +perfor , colon.death)
death.rnd.adhere = coxph(Surv(time,status)~rx + nodes + differ +adhere , colon.death)
death.rnd.extent = coxph(Surv(time,status)~rx + nodes + differ + extent, colon.death)
death.rnd.surg  = coxph(Surv(time,status)~rx + nodes + differ +surg , colon.death)

AIC(death.rnd.sex, death.rnd.age, death.rnd.obstruct, death.rnd.perfor, death.rnd.adhere, death.rnd.extent, death.rnd.surg)

```

Adding extent give us an AIC of 5441.828.

```{r, include = FALSE}
death.rnde.sex = coxph(Surv(time,status)~rx + nodes + differ + extent + sex, colon.death)
death.rnde.age = coxph(Surv(time,status)~rx + nodes + differ + extent + age, colon.death)
death.rnde.obstruct = coxph(Surv(time,status)~rx + nodes + differ + extent + obstruct, colon.death)
death.rnde.perfor = coxph(Surv(time,status)~rx + nodes + differ + extent + perfor, colon.death)
death.rnde.adhere = coxph(Surv(time,status)~rx + nodes + differ + extent + adhere, colon.death)
death.rnde.surg = coxph(Surv(time,status)~rx + nodes + differ + extent + surg, colon.death)

AIC(death.rnde.sex, death.rnde.age, death.rnde.obstruct, death.rnde.perfor,
    death.rnde.adhere, death.rnde.surg)


```

Adding surg gives an AIC of 5438.274.

```{r, include = FALSE}
death.rndes.sex = coxph(Surv(time,status)~rx + nodes + differ + extent + surg + sex, colon.death)
death.rndes.age = coxph(Surv(time,status)~rx + nodes + differ + extent + surg + age, colon.death)
death.rndes.obstruct = coxph(Surv(time,status)~rx + nodes + differ + extent + surg + obstruct, colon.death)
death.rndes.perfor = coxph(Surv(time,status)~rx + nodes + differ + extent + surg + perfor, colon.death)
death.rndes.adhere = coxph(Surv(time,status)~rx + nodes + differ + extent + surg + adhere, colon.death)

AIC(death.rndes.sex, death.rndes.age, death.rndes.obstruct, death.rndes.perfor, death.rndes.adhere)
```

Adding obstruct gives us an AIC of 5436.907, which is different from the recur data, where at this point, adding sex as out next covariate gave us the lower AIC score. 

```{r, include = FALSE}
BIC(death.rnde.surg, death.rndes.obstruct)

```
By using BIC, which penalizes the number of covariates more than AIC, we can see that the previous model, without obstruct, is a better model as it gives a BIC of 5462.657. Therefore, we will use the exact same covariates as the recurrence model.  

### Checking Proportional Hazards Assumptions

```{r}
cox.zph(death.rnde.surg)

colon.fit.differ = survfit(Surv(time, status) ~ differ, colon.death)
ggsurvplot(colon.fit.differ, colon.death, legend.labs=c('Well','Moderate', 'Poor'), fun='cloglog') + 
  labs(x='Days until Recurrence')
```

We can also observe, that similarly to our recurrence model the differentiation covariate again violates the PH assumption. We can verify this using a log-log plot, which shows many cross-over points bewteen 'moderate' differentiation and 'well' differentiation. We will remedy this using a stratification on the differentiation variable. 

```{r}
death.rnde.surg <- coxph(Surv(time,status)~rx + nodes + strata(differ) + extent + surg, colon.death)
AIC(death.rnde.surg)
```

Our AIC drops to 4769.91 after stratifying on the differentiation covariate instead of simply using it as a covariate in our model. This is a significant decrease and proves that our previous model had an alarming violation of the PH assumption. 

```{r}
cox.zph(death.rnde.surg)
```

We run cox ZPH again on this new stratified cox PH model to ensure no violations and observe that we have successfully remedied our issue. All of our p-values from the cox ZPH test are above 0.05. 


# 3. Advanced Models 
## Recurrent Events Model

```{r}
colon$start=0
colon$stop = colon$time

colon.cox = coxph(Surv(start,stop,status)~rx + strata(etype), colon)
summary(colon.cox)
anova(colon.cox)
```
To produce a combined model that considers both recurrence and death, we will restructure our data into stop-start data format. We will use the marginal recurrent event approach, since each event is of a different nature. The first occurrence for each subject is a recurrence of cancer, while the second occurrence is death. Therefore, each start time will be 0 and each stop time will be time of death or time of recurrence. 

In our recurrent events model, we again observe with a p-value of 0.788 that the Lemavisole treatment in itself is not effective in reducing time until recurrence or death. However, Levamisole treatment combined with the moderately toxic 5FU treatment is effective in reducing time until recurrence or death, as it has a p-value of ~ 0. Similarly to our recurrence and death analyses which were conducted separately, we reach the same conclusion that is noted by the researchers of the original study (Laurie 1989).


```{r}
colon.CI = exp(confint(colon.cox))
colon.CI
```
We confirm with 95% confidence that Levamisole treatment is not effective in itself using a confidence interval [0.843, 1.139] that contains 1. Our confidence interval for Levamisole+5FU treatment is quite small [0.545,0.757] and does not contain 1. We confirm our previous conclusion with 95% confidence that the combined treatment is effective in reducing time until recurrence or death. 

```{r}
exp(coef(colon.cox))
```

The instantaneous hazard rate for Levamisole+5FU treatment is 0.642 times as large as the baseline hazard rate. We conclude that the treatment is indeed effective in significantly reducing time until a recurrence or death. This is the same conclusion that was derived from the recurrence data set as well as the death data set, but we can confirm that the combination treatment of low-toxicity and medium-toxicity compounds retains its effectiveness in the combined model of both event types. 

## Adding Covariates to the Combined Data Set

Again using forward stepwise selection, AIC scores, and verifying AIC scores using BIC when improvements are minimal, we will add the other covariates into our full model. 
```{r, warning = FALSE}
full.rx.sex = coxph(Surv(start, stop,status)~rx + sex, colon)
full.rx.age = coxph(Surv(start, stop,status)~rx + age, colon)
full.rx.obstruct = coxph(Surv(start, stop,status)~rx + obstruct, colon)
full.rx.perfor = coxph(Surv(start, stop,status)~rx + perfor, colon)
full.rx.adhere = coxph(Surv(start, stop,status)~rx + adhere, colon)
full.rx.nodes = coxph(Surv(start, stop,status)~rx + nodes, colon)
full.rx.differ = coxph(Surv(start, stop,status)~rx + differ, colon)
full.rx.extent = coxph(Surv(start, stop,status)~rx + extent, colon)
full.rx.surg = coxph(Surv(start, stop, status)~rx + surg, colon)
full.rx.node4 = coxph(Surv(start, stop,status)~rx + node4, colon)

AIC(full.rx.sex, full.rx.age, full.rx.obstruct, full.rx.perfor,
    full.rx.adhere, full.rx.nodes, full.rx.differ, full.rx.extent,
    full.rx.surg, full.rx.node4)
```
Similar to our data with etype = 1 and etype = 2, adding nodes as the next covariate after rx gave us the lowest AIC, 12686.50, in our combined data set. Differ and node4 followed with the next lowest AIC scores of 12815.31 and 13019.81 respectively. 

```{r, warning = FALSE}
full.rn.sex = coxph(Surv(start, stop,status)~rx + nodes + sex, colon)
full.rn.age = coxph(Surv(start, stop,status)~rx + nodes + age, colon)
full.rn.obstruct = coxph(Surv(start, stop,status)~rx + nodes+  obstruct, colon)
full.rn.perfor = coxph(Surv(start, stop,status)~rx + nodes + perfor, colon)
full.rn.adhere = coxph(Surv(start, stop,status)~rx + nodes + adhere, colon)
full.rn.differ = coxph(Surv(start, stop,status)~rx + nodes + differ, colon)
full.rn.extent = coxph(Surv(start, stop,status)~rx + nodes + extent, colon)
full.rn.surg = coxph(Surv(start, stop, status)~rx + nodes + surg, colon)

AIC(full.rn.sex, full.rn.age, full.rn.obstruct, full.rn.perfor,
    full.rn.adhere, full.rn.differ, full.rn.extent,
    full.rn.surg)
```
Adding differ gives us the lowest AIC of 12342.15 after adding nodes. 

```{r}
full.rnd.sex = coxph(Surv(start, stop,status)~rx + nodes + differ+ sex, colon)
full.rnd.age = coxph(Surv(start, stop,status)~rx + nodes + differ + age, colon)
full.rnd.obstruct = coxph(Surv(start, stop,status)~rx + nodes + differ + obstruct, colon)
full.rnd.perfor = coxph(Surv(start, stop,status)~rx + nodes + differ + perfor, colon)
full.rnd.adhere = coxph(Surv(start, stop,status)~rx + nodes + differ + adhere, colon)
full.rnd.extent = coxph(Surv(start, stop,status)~rx + nodes + differ + extent, colon)
full.rnd.surg = coxph(Surv(start, stop, status)~rx + nodes + differ + surg, colon)


AIC(full.rnd.sex, full.rnd.age, full.rnd.obstruct, full.rnd.perfor,
    full.rnd.adhere, full.rnd.extent,
    full.rnd.surg)
```
Adding extent as our next covariate gives us an AIC of 12306.57. 

```{r}
full.rnde.sex = coxph(Surv(start, stop,status)~rx + nodes + differ+ extent + sex, colon)
full.rnde.age = coxph(Surv(start, stop,status)~rx + nodes + differ + extent + age, colon)
full.rnde.obstruct = coxph(Surv(start, stop,status)~rx + nodes + differ + extent+  obstruct, colon)
full.rnde.perfor = coxph(Surv(start, stop,status)~rx + nodes + differ + extent+ perfor, colon)
full.rnde.adhere = coxph(Surv(start, stop,status)~rx + nodes + differ + extent+ adhere, colon)
full.rnde.surg = coxph(Surv(start, stop, status)~rx + nodes + differ + extent+ surg, colon)


AIC(full.rnde.sex, full.rnde.age, full.rnde.obstruct, full.rnde.perfor,
    full.rnde.adhere, full.rnde.surg)
```
Adding obstruct gives us an AIC of 12302.53. 

```{r}
full.rndeo.sex = coxph(Surv(start, stop,status)~rx + nodes + differ+ extent + obstruct + sex, colon)
full.rndeo.age = coxph(Surv(start, stop,status)~rx + nodes + differ + extent + obstruct + age, colon)
full.rndeo.perfor = coxph(Surv(start, stop,status)~rx + nodes + differ + extent+ obstruct + perfor, colon)
full.rndeo.adhere = coxph(Surv(start, stop,status)~rx + nodes + differ + extent+ obstruct + adhere, colon)
full.rndeo.surg = coxph(Surv(start, stop, status)~rx + nodes + differ + extent+ obstruct + surg, colon)


AIC(full.rndeo.sex, full.rndeo.age, full.rndeo.perfor,
    full.rndeo.adhere, full.rndeo.surg)
```
Adding surg gives us an AIC score of 12294.01.

```{r}
BIC(full.rnde.obstruct, full.rndeo.surg)
```
By using BIC, which penalizes the number of covariates more strictly than AIC, we can see that the model with surg is a better model as it gives a BIC of 12327.44 as opposed to 12331.18 for the model without surg. We will take another step of adding covariates to see if it improves the model. 

```{r}
full.rndeos.sex = coxph(Surv(start, stop,status)~rx + nodes + differ+ extent + obstruct + surg + sex, colon)
full.rndeos.age = coxph(Surv(start, stop,status)~rx + nodes + differ + extent + obstruct + surg+ age, colon)
full.rndeos.perfor = coxph(Surv(start, stop,status)~rx + nodes + differ + extent+ obstruct + surg + perfor, colon)
full.rndeos.adhere = coxph(Surv(start, stop,status)~rx + nodes + differ + extent+ obstruct + surg + adhere, colon)


AIC(full.rndeos.sex, full.rndeos.age, full.rndeos.perfor,
    full.rndeos.adhere)
```
Adding adhere gives us an AIC of 12291.93, but we will use BIC to evaluate if this addition is better than the previous model without adhere. 

```{r}
BIC(full.rndeo.surg, full.rndeos.adhere)
```
Looking at the BIC, we can see that the previous model without adhere has a lower BIC of 12327.44. 

# 4. Citations
Laurie, J A et al. “Surgical adjuvant therapy of large-bowel carcinoma: an evaluation of levamisole and the combination of levamisole and fluorouracil. The North Central Cancer Treatment Group and the Mayo Clinic.” Journal of clinical oncology : official journal of the American Society of Clinical Oncology vol. 7,10 (1989): 1447-56. doi:10.1200/JCO.1989.7.10.1447

